<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Kannada Suddi</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet"/>
<style>
  body { font-family: 'Baloo 2', cursive; }
</style>
</head>
<body class="bg-white w-screen h-screen flex flex-col">

<!-- Main Container -->
<div class="max-w-xs mx-auto mt-4 rounded-3xl overflow-hidden shadow-lg border border-gray-200" style="max-width: 360px;">
  
  <!-- Header -->
  <div class="bg-[#d92a1a] relative flex items-center justify-between px-4 py-3 rounded-t-3xl">
    <button aria-label="Menu" class="text-white text-xl">
      <i class="fas fa-bars"></i>
    </button>
    <h1 class="text-white font-extrabold tracking-wider select-none text-lg" style="font-weight: 900;">
      ಕನ್ನಡ | ಸುದ್ದು
    </h1>
    <button aria-label="Camera" class="text-white text-xl">
      <i class="fas fa-video"></i>
    </button>
  </div>

  <!-- Categories Row -->
  <nav id="categoriesRow" class="bg-[#d92a1a] flex justify-around text-white text-xs font-semibold tracking-wide py-2 select-none" style="font-size: 0.75rem;">
    <!-- Dynamic Categories Here -->
  </nav>

  <!-- Channels Grid -->
  <div id="channelsGrid" class="bg-white px-4 py-4 grid grid-cols-3 gap-y-6 gap-x-4">
    <!-- Dynamic Channels Here -->
  </div>
</div>

<script>
let channelsData = [];
let categories = [];
let selectedCategory = "";

// Render categories dynamically
function renderCategories() {
  const row = document.getElementById('categoriesRow');
  row.innerHTML = '';
  
  categories.forEach(cat => {
    const link = document.createElement('a');
    link.textContent = cat;
    link.href = "#";
    link.className = `hover:underline ${selectedCategory === cat ? 'font-bold underline' : ''}`;
    link.addEventListener('click', (e) => {
      e.preventDefault();
      selectedCategory = cat;
      renderCategories();
      renderChannels();
    });
    row.appendChild(link);
  });
}

// Render channels dynamically
function renderChannels() {
  const grid = document.getElementById('channelsGrid');
  grid.innerHTML = '';

  const filtered = channelsData.filter(ch => ch.category === selectedCategory);
  filtered.forEach(channel => {
    const div = document.createElement('div');
    div.className = 'flex flex-col items-center space-y-1 cursor-pointer';
    div.innerHTML = `
      <img src="${channel.icon}" alt="${channel.name}" class="w-14 h-14 rounded-md object-contain"/>
      <span class="text-xs text-gray-900 select-none truncate" style="max-width:64px;">
        ${channel.name}
      </span>
    `;
    div.addEventListener('click', () => {
      const nameParam = encodeURIComponent(channel.name);
      window.location.href = \`player.html?name=\${nameParam}\`;
    });
    grid.appendChild(div);
  });
}

// Load channels.json
async function loadChannels() {
  try {
    const res = await fetch('tv/data/channels.json');
    channelsData = await res.json();

    // Extract unique categories from channels
    categories = [...new Set(channelsData.map(ch => ch.category))];
    selectedCategory = categories[0]; // Default first category

    renderCategories();
    renderChannels();
  } catch (err) {
    console.error('Error loading channels.json:', err);
  }
}

loadChannels();
</script>

</body>
</html>