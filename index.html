<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Notifications - Live TV</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

<style>
body { font-family: 'Roboto', sans-serif; background-color:#121212; color:white; margin:0; min-height:100vh; }
.notification-card { display:flex; align-items:center; gap:12px; background:#1E1E1E; padding:12px; border-radius:12px; margin-bottom:12px; cursor:pointer; transition:all 0.3s ease; }
.notification-card:hover { background:#2C2C2C; transform:translateY(-2px); }
.notification-icon { width:60px; height:60px; border-radius:12px; object-fit:cover; background:#111; display:flex; align-items:center; justify-content:center; font-size:28px; flex-shrink:0; }
.notification-content { flex:1; }
.notification-title { font-weight:700; font-family:'Baloo 2', cursive; font-size:1rem; }
.notification-category { font-size:0.85rem; color:#9ca3af; margin-top:2px; }
.new-badge { display:inline-block; background:#facc15; color:#000; font-size:0.7rem; font-weight:700; padding:2px 6px; border-radius:8px; margin-left:6px; }
.notification-card.new { border:1px solid #facc15; animation: glow 1.5s ease-in-out 2; }
@keyframes glow { 0%,100%{box-shadow:0 0 12px #facc15;} 50%{box-shadow:0 0 24px #facc15;} }
.empty-state { display:flex; flex-direction:column; align-items:center; justify-content:center; margin-top:3rem; text-align:center; }
.empty-state .title { font-size:1.5rem; font-weight:700; color:#facc15; margin-bottom:1rem; }
.empty-state img { max-width:240px; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,0.6); }
</style>
</head>
<body class="flex flex-col min-h-screen">

<!-- Header -->
<div id="header"></div>

<main class="flex-1 p-4" id="notificationsContainer">
  <!-- Skeleton loader while fetching -->
  <div class="notification-card" style="height:70px; opacity:0.6;"></div>
  <div class="notification-card" style="height:70px; opacity:0.6;"></div>
  <div class="notification-card" style="height:70px; opacity:0.6;"></div>
</main>

<!-- Footer -->
<div id="footer"></div>

<script src="assets/js/header.js"></script>
<script src="assets/js/footer.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
  authDomain: "tnm3ulive.firebaseapp.com",
  databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tnm3ulive",
  storageBucket: "tnm3ulive.firebasestorage.app",
  messagingSenderId: "80664356882",
  appId: "1:80664356882:web:c8464819b0515ec9b210cb",
  measurementId: "G-FNS9JWZ9LS"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const container = document.getElementById('notificationsContainer');
let channelsCache = [], notificationsCache = [];

function timeAgo(timestamp) {
  if(!timestamp) return "";
  const diff = Math.floor((Date.now() - timestamp)/1000);
  if(diff<60) return diff+"s ago";
  if(diff<3600) return Math.floor(diff/60)+"m ago";
  if(diff<86400) return Math.floor(diff/3600)+"h ago";
  return Math.floor(diff/86400)+"d ago";
}

function createNotificationCard(notification){
  const card = document.createElement('div');
  card.className = 'notification-card';
  if(notification.url) card.onclick = ()=> window.location.href = notification.url;

  const ONE_DAY = 24*60*60*1000;
  const isNew = Date.now() - (notification.timestamp||0) < ONE_DAY;
  if(isNew) card.classList.add('new');

  const img = document.createElement('img');
  img.className='notification-icon';
  img.src = notification.logo||'';
  img.alt = notification.name||'Notification';
  img.onerror = ()=>{
    const icon = document.createElement('span');
    icon.className='material-symbols-outlined notification-icon';
    icon.textContent='notifications';
    img.replaceWith(icon);
  };

  const content = document.createElement('div');
  content.className='notification-content';

  const title = document.createElement('div');
  title.className='notification-title';
  title.textContent = notification.message || "New Update";

  if(isNew){
    const badge = document.createElement('span');
    badge.className='new-badge';
    badge.textContent='NEW';
    title.appendChild(badge);
  }

  const meta = document.createElement('div');
  meta.className='notification-category';
  meta.textContent = `${notification.category||'Update'} • ${timeAgo(notification.timestamp)}`;

  content.appendChild(title);
  content.appendChild(meta);
  card.appendChild(img);
  card.appendChild(content);

  return card;
}

function renderEmptyState(){
  container.innerHTML = `
    <div class="empty-state">
      <div class="title">ஒன்னும் இல்லை!</div>
      <img src="https://tvicn.wordpress.com/wp-content/uploads/2025/09/20250903_0032382345023889667523819.jpg" alt="Empty State"/>
    </div>
  `;
}

function renderNotifications(list){
  container.innerHTML='';
  if(list.length===0){
    renderEmptyState();
    return;
  }
  list.forEach(n=> container.appendChild(createNotificationCard(n)));
}

// Firebase listeners
firebase.database().ref('channels').on('value', snap=>{
  const data = snap.val()||{};
  channelsCache = Object.entries(data).map(([id,c])=>({
    message: `New channel added: ${c.name||'Unknown'}`,
    logo: c.icon||'',
    url: c.stream||'',
    name: c.name||'Unknown',
    timestamp: c.createdAt ? new Date(c.createdAt).getTime() : 0,
    category: 'Channel'
  }));
  updateUI();
});

firebase.database().ref('notifications').on('value', snap=>{
  const data = snap.val()||{};
  notificationsCache = Object.entries(data).map(([id,n])=>({
    message: n.message,
    logo: n.logo||'',
    url: n.url||'',
    name: n.message||'Notification',
    timestamp: n.timestamp||0,
    category: n.type||'Notification'
  }));
  updateUI();
});

function updateUI(){
  const merged = [...channelsCache, ...notificationsCache].sort((a,b)=>b.timestamp - a.timestamp);
  const latest10 = merged.slice(0,10);
  renderNotifications(latest10);
}
</script>

</body>
</html>
