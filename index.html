<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>My Live TV</title>
<link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
<style>
  html, body { margin:0; padding:0; background:#000; height:100%; width:100%; overflow:hidden; }
  .player-container { position:relative; width:100%; height:100%; }
  video, iframe { width:100%; height:100%; object-fit:cover; }

  .overlay { position:absolute; top:15px; left:15px; color:white; font-family:Arial,sans-serif; background:rgba(0,0,0,0.4); padding:10px 15px; border-radius:8px; display:flex; flex-direction:column; }
  .overlay .channel-name { font-weight:bold; font-size:20px; margin-bottom:4px; }
  .overlay .clock { font-size:16px; }

  .ticker-container { position:absolute; bottom:0; width:100%; background:rgba(0,0,0,0.6); overflow:hidden; height:40px; display:flex; align-items:center; }
  .ticker-track { display:flex; white-space:nowrap; animation:scroll linear infinite; }
  .ticker-item { color:#fff; font-size:16px; font-family:Arial,sans-serif; padding:0 50px; }
  @keyframes scroll { 0% { transform:translateX(0); } 100% { transform:translateX(-50%); } }
</style>
</head>
<body>

<div class="player-container">
  <div id="player-wrapper"></div>

  <!-- Top overlay -->
  <div class="overlay">
    <div class="channel-name">My Live TV</div>
    <div class="clock" id="clock"></div>
  </div>

  <!-- Bottom ticker -->
  <div class="ticker-container">
    <div class="ticker-track" id="ticker-track"></div>
  </div>
</div>

<script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>
<script>
const PLAYLIST_URL = 'https://ppsmrt.github.io/tv/playlist.json';
let playlistData = [];
let currentIndex = 0;
let plyrPlayer = null;
let ytPlayer = null;
const playerWrapper = document.getElementById('player-wrapper');

// --- Orientation & Fullscreen ---
function requestFullScreen() {
  const el = document.documentElement;
  if (el.requestFullscreen) el.requestFullscreen();
  else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
  else if (el.msRequestFullscreen) el.msRequestFullscreen();
}
function lockLandscape() {
  if (screen.orientation && screen.orientation.lock) screen.orientation.lock('landscape').catch(()=>{});
}
window.addEventListener('load', ()=>{
  requestFullScreen();
  lockLandscape();
});

// --- Load playlist ---
async function loadPlaylist() {
  const response = await fetch(PLAYLIST_URL);
  const data = await response.json();
  playlistData = data;
  playVideo(0);
}

// --- Clear current player ---
function clearPlayer() {
  playerWrapper.innerHTML = '';
  if (plyrPlayer) { plyrPlayer.destroy(); plyrPlayer = null; }
  if (ytPlayer) { ytPlayer.destroy(); ytPlayer = null; }
}

// --- Play video ---
function playVideo(index) {
  currentIndex = index;
  const video = playlistData[index];
  clearPlayer();

  if(video.type === 'file') {
    const videoEl = document.createElement('video');
    videoEl.setAttribute('autoplay', true);
    videoEl.setAttribute('playsinline', true);
    videoEl.setAttribute('muted', true);
    videoEl.src = video.url;
    playerWrapper.appendChild(videoEl);
    plyrPlayer = new Plyr(videoEl, { controls:[], autoplay:true });
    videoEl.onended = nextVideo;

  } else if(video.type === 'youtube') {
    const iframe = document.createElement('div');
    iframe.id = 'youtube-player';
    playerWrapper.appendChild(iframe);
    ytPlayer = new YT.Player('youtube-player', {
      videoId: extractYouTubeID(video.url),
      events: {
        'onReady': e => { e.target.playVideo(); },
        'onStateChange': e => { if(e.data === YT.PlayerState.ENDED) nextVideo(); }
      },
      playerVars: { autoplay:1, controls:0, modestbranding:1, rel:0, showinfo:0 }
    });
  }
}

// --- Next video ---
function nextVideo() {
  currentIndex = (currentIndex + 1) % playlistData.length;
  playVideo(currentIndex);
}

// --- Extract YouTube ID ---
function extractYouTubeID(url) {
  const regExp = /(?:https?:\/\/)?(?:www\.)?youtu(?:\.be\/|be\.com\/watch\?v=)([^\s&]+)/;
  const match = url.match(regExp);
  return match ? match[1] : '';
}

// --- Clock ---
function updateClock() {
  const now = new Date();
  document.getElementById('clock').textContent = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
}
setInterval(updateClock,1000);
updateClock();

// --- Smooth ticker ---
const tickerMessages = [
  "Welcome to My Live TV!",
  "Streaming videos and music continuously.",
  "Local files and YouTube playlist combined.",
  "Enjoy your TV experience!"
];
const tickerTrack = document.getElementById('ticker-track');
function buildTicker() {
  tickerTrack.innerHTML = '';
  [...tickerMessages,...tickerMessages].forEach(msg=>{
    const span = document.createElement('span');
    span.className='ticker-item';
    span.textContent=msg;
    tickerTrack.appendChild(span);
  });
  const trackWidth = tickerTrack.scrollWidth / 2;
  const speed = 100;
  tickerTrack.style.animationDuration = (trackWidth/speed) + 's';
}
buildTicker();
window.addEventListener('resize', buildTicker);

loadPlaylist();
</script>
</body>
</html>