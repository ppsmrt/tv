<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generate IPTV Playlist</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f8f9fa; }
  #playlist-box { white-space: pre-wrap; background: #fff; padding: 15px; border-radius: 8px; font-size: 14px; overflow-x: auto; margin-top: 15px; border: 1px solid #ddd; }
  .btn { display: inline-block; padding: 10px 15px; margin-top: 15px; background: #007bff; color: #fff; text-decoration: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
  .btn + .btn { margin-left: 10px; }
</style>
</head>
<body>
<h1>IPTV Playlist Generator</h1>
<p>Below is your playlist generated from Firebase. You can copy it or download it.</p>

<div id="playlist-box">Loading playlist...</div>
<a id="download" class="btn" style="display:none;">Download Playlist</a>

<script>
const FIREBASE_URL = "https://tamilgeo-d10d6-default-rtdb.firebaseio.com/channels.json";

// DOM Elements
const playlistBox = document.getElementById("playlist-box");
const downloadBtn = document.getElementById("download");

// Generate playlist content
function generatePlaylist(channels) {
  let playlist = "#EXTM3U\n";
  const validChannels = Object.values(channels || {}).filter(ch => ch.name && ch.stream);
  validChannels.sort((a,b) =>
    (a.category||"").localeCompare(b.category||"") ||
    (a.name||"").localeCompare(b.name||"")
  );
  for(const ch of validChannels) {
    playlist += `#EXTINF:-1 tvg-name="${ch.name}" group-title="${ch.category||''}" tvg-logo="${ch.icon||''}",${ch.name}\n`;
    playlist += `${ch.stream}\n`;
  }
  return playlist;
}

// Load playlist from Firebase
async function loadPlaylist() {
  try {
    const res = await fetch(FIREBASE_URL);
    const data = await res.json();
    console.log("Fetched data:", data);  // DEBUG LOG

    if (!data || Object.keys(data).length === 0) {
      playlistBox.textContent = "No channels found in Firebase.";
      return;
    }

    const playlist = generatePlaylist(data);
    playlistBox.textContent = playlist;

    // Download link
    const blob = new Blob([playlist], { type: "audio/x-mpegurl" });
    const url = URL.createObjectURL(blob);
    downloadBtn.href = url;
    downloadBtn.download = "playlist.m3u";
    downloadBtn.style.display = "inline-block";

  } catch(err) {
    console.error(err);
    playlistBox.textContent = "Error loading channels from Firebase.";
  }
}

// Initialize
loadPlaylist();
</script>
</body>
</html>
