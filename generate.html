<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generate M3U Playlist</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
    authDomain: "tnm3ulive.firebaseapp.com",
    databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "tnm3ulive",
    storageBucket: "tnm3ulive.firebasestorage.app",
    messagingSenderId: "80664356882",
    appId: "1:80664356882:web:c8464819b0515ec9b210cb",
    measurementId: "G-FNS9JWZ9LS"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Function to generate M3U
  async function generateM3U() {
    const channelsRef = ref(db, 'channels');
    const snapshot = await get(channelsRef);
    if (!snapshot.exists()) {
      alert("No channels found in the database.");
      return;
    }

    const channels = snapshot.val();
    let m3uContent = "#EXTM3U\n";

    for (const channelId in channels) {
      const channel = channels[channelId];
      const name = channel.name || "Unknown";
      const category = channel.category || "General";
      const logo = channel.logo || "";
      const streamUrl = channel.url || "";

      m3uContent += `#EXTINF:-1 tvg-name="${name}" group-title="${category}" tvg-logo="${logo}",${name}\n`;
      m3uContent += `${streamUrl}\n`;
    }

    // Create a downloadable link
    const blob = new Blob([m3uContent], { type: 'application/vnd.apple.mpegurl' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'playlist.m3u';
    link.click();
    URL.revokeObjectURL(url);
  }

  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('generateBtn').addEventListener('click', generateM3U);
  });
</script>
</head>
<body style="font-family:sans-serif; text-align:center; margin-top:50px;">
  <h1>Generate M3U Playlist</h1>
  <button id="generateBtn" style="padding:10px 20px; font-size:16px; cursor:pointer;">Generate Playlist</button>
  <p>Click the button to generate <strong>playlist.m3u</strong> from your Firebase channels.</p>
</body>
</html>