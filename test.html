<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Live TV - Channels & Requests</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>

<!-- Baloo 2 Font -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet"/>

<style>
  html, body {
    font-family: 'Baloo 2', cursive;
    background-color: #111827;
    color: #fff;
    margin: 0;
    min-height: 100vh;
  }
  header {
    height: 64px;
    display: flex;
    align-items: center;
    padding: 0 1.5rem;
    background: rgba(31,41,55,0.9);
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    z-index: 20;
  }
  main {
    padding: 20px 1rem 100px;
    max-width: 1200px;
    margin: 0 auto;
  }
  .channels-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 20px;
  }
  .channel-card {
    background: #1f2937;
    border-radius: 16px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .channel-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(248, 113, 113, 0.4); }
  .channel-image { width: 100%; aspect-ratio: 16/9; object-fit: cover; border-bottom: 1px solid #374151; }
  .channel-name {
    padding: 12px 8px;
    font-weight: 700;
    font-size: 1rem;
    text-align: center;
    color: #f9fafb;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .section-title { font-size: 1.5rem; font-weight: 700; margin: 20px 0 12px; }
  @media(max-width:640px){
    .channels-grid { grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 16px; }
    .channel-name { font-size: 0.95rem; }
  }
</style>
</head>
<body>

<header>
  <span class="material-icons">live_tv</span>
  <h1 class="ml-2 text-lg font-bold">Live TV</h1>
</header>

<main>
  <h2 class="section-title">Approved Channels</h2>
  <section class="channels-grid" id="channelsGrid"></section>

  <h2 class="section-title">Approved Channel Requests</h2>
  <section class="channels-grid" id="requestsGrid"></section>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
  authDomain: "tnm3ulive.firebaseapp.com",
  databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tnm3ulive",
  storageBucket: "tnm3ulive.firebasestorage.app",
  messagingSenderId: "80664356882",
  appId: "1:80664356882:web:c8464819b0515ec9b210cb",
  measurementId: "G-FNS9JWZ9LS"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const channelsGrid = document.getElementById('channelsGrid');
const requestsGrid = document.getElementById('requestsGrid');

function createCard(item, isRequest=false){
  const a = document.createElement('a');
  const safeName = encodeURIComponent(item.name.toLowerCase().replace(/\s+/g,'-'));
  a.href = item.stream || item.url || '#';
  a.className = 'channel-card';
  a.setAttribute('target','_blank');
  a.setAttribute('aria-label', `Watch ${item.name}`);

  const img = document.createElement('img');
  img.src = item.icon || 'https://via.placeholder.com/320x180?text=No+Image';
  img.alt = item.name + ' logo';
  img.className = 'channel-image';

  const nameDiv = document.createElement('div');
  nameDiv.className = 'channel-name';
  nameDiv.textContent = item.name + (isRequest ? ' (Request)' : '');

  a.appendChild(img);
  a.appendChild(nameDiv);
  return a;
}

// Fetch channels
const channelsRef = ref(db,'channels');
onValue(channelsRef, snapshot => {
  const data = snapshot.exists() ? Object.values(snapshot.val()) : [];
  channelsGrid.innerHTML = '';
  data.forEach(c => channelsGrid.appendChild(createCard(c)));
});

// Fetch approved channelRequests
const requestsRef = ref(db,'channelRequests');
onValue(requestsRef, snapshot => {
  const data = snapshot.exists() ? Object.values(snapshot.val()) : [];
  requestsGrid.innerHTML = '';
  data.filter(r => r.status === 'approved').forEach(r => requestsGrid.appendChild(createCard(r,true)));
});
</script>

</body>
</html>