<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live TV</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="bg-gray-100 pb-24">

<!-- Header -->
<header class="bg-red-600 text-white p-4 shadow-md sticky top-0 z-50">
  <h1 class="text-xl font-bold text-center">Live TV</h1>
</header>

<!-- Category Bar -->
<nav id="categoryBar" class="flex overflow-x-auto gap-2 p-2 bg-white sticky top-16 z-40 shadow-md rounded-xl mx-2">
  <button class="px-4 py-2 bg-red-100 text-red-600 rounded-full whitespace-nowrap hover:bg-red-200">All</button>
  <button class="px-4 py-2 bg-red-100 text-red-600 rounded-full whitespace-nowrap hover:bg-red-200">News</button>
  <button class="px-4 py-2 bg-red-100 text-red-600 rounded-full whitespace-nowrap hover:bg-red-200">Music</button>
  <button class="px-4 py-2 bg-red-100 text-red-600 rounded-full whitespace-nowrap hover:bg-red-200">Entertainment</button>
</nav>

<!-- Search Bar -->
<div class="p-4">
  <input type="text" id="searchInput" placeholder="Search channels..." class="w-full p-2 rounded-lg border focus:ring-2 focus:ring-red-500 focus:outline-none">
</div>

<!-- Channels Grid -->
<main id="channelsGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 p-4">
  <!-- Channel cards will be inserted here dynamically -->
</main>

<!-- Bottom Navigation -->
<footer class="fixed bottom-0 left-0 w-full bg-white shadow-t p-2 flex justify-around text-gray-600">
  <button class="flex flex-col items-center">
    <i class="fa fa-home text-xl"></i>
    <span class="text-xs">Home</span>
  </button>
  <button class="flex flex-col items-center">
    <i class="fa fa-tv text-xl"></i>
    <span class="text-xs">Live</span>
  </button>
  <button class="flex flex-col items-center">
    <i class="fa fa-search text-xl"></i>
    <span class="text-xs">Search</span>
  </button>
  <button class="flex flex-col items-center">
    <i class="fa fa-user text-xl"></i>
    <span class="text-xs">Profile</span>
  </button>
</footer>

<!-- Scripts -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
  authDomain: "tnm3ulive.firebaseapp.com",
  databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tnm3ulive",
  storageBucket: "tnm3ulive.appspot.com",
  messagingSenderId: "80664356882",
  appId: "1:80664356882:web:c8464819b0515ec9b210cb"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const channelsGrid = document.getElementById("channelsGrid");
const searchInput = document.getElementById("searchInput");
const categoryBar = document.getElementById("categoryBar");

let allChannels = {};

// Load channels from Firebase
const channelsRef = ref(db, "channels");
onValue(channelsRef, snapshot => {
  allChannels = snapshot.val() || {};
  renderChannels(allChannels);
});

// Render channel cards
function renderChannels(channels) {
  const searchTerm = searchInput.value.toLowerCase();
  const selectedCategory = categoryBar.querySelector(".selected")?.textContent || "All";

  channelsGrid.innerHTML = "";
  Object.entries(channels)
    .filter(([id, ch]) => {
      const matchesName = ch.name.toLowerCase().includes(searchTerm);
      const matchesCategory = selectedCategory === "All" ? true : ch.category === selectedCategory;
      return matchesName && matchesCategory;
    })
    .forEach(([id, ch]) => {
      const card = document.createElement("div");
      card.className = "bg-white rounded-xl shadow-md overflow-hidden cursor-pointer hover:scale-105 transform transition duration-200";
      card.innerHTML = `
        <img src="${ch.icon}" alt="${ch.name}" class="w-full h-28 object-cover">
        <div class="p-2">
          <h3 class="text-sm font-bold truncate">${ch.name}</h3>
          <p class="text-xs text-gray-500">${ch.category}</p>
        </div>
      `;
      card.addEventListener("click", () => {
        // Play channel stream (call your player.js function here)
        console.log("Play channel:", ch.stream);
      });
      channelsGrid.appendChild(card);
    });

  if (!channelsGrid.hasChildNodes()) {
    channelsGrid.innerHTML = "<p class='text-center col-span-full text-gray-500'>No channels found.</p>";
  }
}

// Search input filter
searchInput.addEventListener("input", () => renderChannels(allChannels));

// Category filter
categoryBar.querySelectorAll("button").forEach(btn => {
  btn.addEventListener("click", () => {
    categoryBar.querySelectorAll("button").forEach(b => b.classList.remove("selected", "bg-red-600", "text-white"));
    btn.classList.add("selected", "bg-red-600", "text-white");
    renderChannels(allChannels);
  });
});
</script>

</body>
</html>