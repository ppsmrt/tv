<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Live TV - Dashboard</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

<!-- Baloo 2 -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet" />

<style>
  html, body {
    font-family: 'Baloo 2', cursive;
    background-color: #111827;
    color: #fff;
    margin: 0;
    min-height: 100vh;
  }
  header {
    height: 64px;
    display: flex;
    align-items: center;
    padding: 0 1.5rem;
    background: rgba(31,41,55,0.9);
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    z-index: 50;
  }
  main {
    padding: 20px 1rem 100px;
    max-width: 1200px;
    margin: 0 auto;
  }
  .input-field {
    width: 100%;
    padding: 14px;
    border-radius: 14px;
    border: none;
    background: #1f2937;
    color: #fff;
    font-weight: 500;
    outline: none;
    transition: all 0.3s ease;
  }
  .input-field:focus {
    box-shadow: 0 0 0 3px rgba(248, 113, 113, 0.5);
    background: #111827;
  }
  .file-input::file-selector-button {
    background: #f87171;
    color: white;
    padding: 8px 16px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  .file-input::file-selector-button:hover {
    background: #ef4444;
  }
  #admin-requests .channel-card {
    background: rgba(31, 41, 55, 0.85);
    border-radius: 1rem;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.4);
  }
  #admin-requests .channel-card:hover {
    transform: scale(1.03);
    box-shadow: 0 8px 25px rgba(0,0,0,0.6);
  }
</style>
</head>
<body>

<!-- Header -->
<header class="fixed top-0 left-0 right-0 z-50 h-16 flex items-center justify-between px-6 bg-gray-800 bg-opacity-90 backdrop-blur-md shadow-lg">
  <div class="flex items-center space-x-3">
    <span class="material-icons text-white text-3xl">account_circle</span>
    <h1 class="text-xl font-bold text-white">Dashboard</h1>
  </div>
  <div>
    <button id="logout-btn" class="flex items-center space-x-2 text-gray-200 hover:text-red-400 transition">
      <span class="material-icons text-lg">logout</span>
      <span class="font-semibold text-sm">Logout</span>
    </button>
  </div>
</header>

<!-- Main Content -->
<main class="pt-20 px-6">
  
  <!-- User Section -->
  <div id="user-section" class="hidden space-y-10">
    <!-- Submit Channel -->
    <div class="bg-gradient-to-br from-gray-800 via-gray-900 to-gray-800 p-8 rounded-3xl shadow-2xl max-w-lg mx-auto space-y-6 transform transition-all duration-300 hover:scale-105">
      <h2 class="text-3xl font-extrabold text-red-500 text-center tracking-wide">Submit a Channel</h2>
      <div class="space-y-4">
        <input type="text" id="channel-name" placeholder="Channel Name" class="input-field" />
        <div class="flex flex-col">
          <input type="file" id="channel-icon-file" accept="image/*" class="file-input" />
          <small id="upload-status" class="text-gray-400 block text-sm mt-1"></small>
        </div>
        <input type="text" id="channel-url" placeholder="Stream URL" class="input-field" />
        <select id="channel-category" class="input-field">
         <option value="">Select Category</option>
        <option value="Tamil">Tamil</option>
        <option value="Telugu">Telugu</option>
        <option value="Kannada">Kannada</option>
        <option value="Malayalam">Malayalam</option>
        <option value="Hindi">Hindi</option>
        <option value="Kids">Kids</option>
        <option value="Sports">Sports</option>
        </select>
        <button onclick="submitChannel()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 rounded-xl shadow-lg transition-all duration-300 transform hover:-translate-y-1">Submit Channel</button>
      </div>
      <p class="text-xs text-gray-400 text-center">ðŸ’¡ Use PNG/JPG for better results. Max size 2MB.</p>
</div>
    </div>

    <!-- User Pending -->
    <div id="user-section" class="space-y-4 max-w-3xl mx-auto">
      <h3 class="text-2xl font-semibold border-b border-gray-700 pb-2">Pending Requests</h3>
      <div id="user-pending" class="space-y-3"></div>
    </div>

    <!-- User Approved -->
    <div id="user-section" class="space-y-4 max-w-3xl mx-auto">
      <h3 class="text-2xl font-semibold border-b border-gray-700 pb-2">Approved Channels</h3>
      <div id="user-approved" class="space-y-3"></div>
    </div>
  </div>

  <!-- Admin Section -->
  <div id="admin-section" class="hidden space-y-8">
    <div class="max-w-4xl mx-auto flex items-center justify-between bg-gray-800/90 backdrop-blur-sm p-5 rounded-2xl shadow-xl">
      <h2 class="text-2xl md:text-3xl font-extrabold text-red-500 tracking-wide">Pending Channel Requests</h2>
      <span class="material-icons text-white text-3xl cursor-pointer hover:text-red-400" title="Refresh" onclick="loadAdminRequests()">refresh</span>
    </div>
    <div id="admin-requests" class="space-y-4 max-w-4xl mx-auto"></div>
  </div>

<!-- Footer -->
<div id="footer"></div>

<!-- Toast -->
<div id="toast-container" class="fixed bottom-6 right-6 flex flex-col gap-3 z-50"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<!-- Dashboard JS -->
<script type="module">
document.addEventListener('DOMContentLoaded', () => {
const firebaseConfig = {
  apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
  authDomain: "tnm3ulive.firebaseapp.com",
  databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tnm3ulive",
  storageBucket: "tnm3ulive.firebasestorage.app",
  messagingSenderId: "80664356882",
  appId: "1:80664356882:web:c8464819b0515ec9b210cb",
  measurementId: "G-FNS9JWZ9LS"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

function showToast(message, type = "info") {
  const toast = document.createElement('div');
  toast.className = `
    flex items-center gap-3 px-4 py-3 rounded-xl shadow-lg text-white transition-all duration-300 transform
    opacity-0 translate-x-10
    ${type === "success" ? "bg-green-500" :
      type === "error" ? "bg-red-500" :
      "bg-gray-700"}
  `;
  const icon = document.createElement('span');
  icon.className = 'material-icons';
  icon.textContent = type === "success" ? 'check_circle' : type === "error" ? 'error' : 'info';
  toast.appendChild(icon);
  const msg = document.createElement('span');
  msg.textContent = message;
  toast.appendChild(msg);
  document.getElementById('toast-container').appendChild(toast);
  requestAnimationFrame(() => {
    toast.style.opacity = '1';
    toast.style.transform = 'translateX(0)';
  });
  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateX(50px)';
    toast.addEventListener('transitionend', () => toast.remove());
  }, 3000);
}

// ImgBB Upload
async function uploadToImgBB(file, inputElement = null) {
  try {
    const formData = new FormData();
    formData.append("image", file);

    const response = await fetch("https://api.imgbb.com/1/upload?key=8604e4b4050c63c460d0bca39cf28708", {
      method: "POST",
      body: formData
    });

    const data = await response.json();
    if (data.success) {
      showToast("Image uploaded successfully!", "success");
      if (inputElement) inputElement.value = ""; // Auto-clear input
      return data.data.url;
    } else {
      throw new Error("ImgBB upload failed");
    }
  } catch (err) {
    console.error(err);
    showToast("Image upload failed", "error");
    throw err;
  }
}

// Submit channel
window.submitChannel = async function () {
  const name = document.getElementById('channel-name').value.trim();
  const url = document.getElementById('channel-url').value.trim();
  const category = document.getElementById('channel-category').value;
  const fileInput = document.getElementById('channel-icon-file');
  const statusText = document.getElementById('upload-status');
  const user = auth.currentUser;

  if (!user) return showToast("User not signed in", "error");
  if (!name || !url || fileInput.files.length === 0) return showToast("Fill all fields", "error");

  try {
    statusText.textContent = "Uploading...";
    const iconUrl = await uploadToImgBB(fileInput.files[0], fileInput);
    statusText.textContent = "";

    const requestId = db.ref('channelRequests').push().key;
    await db.ref(`channelRequests/${requestId}`).set({
      name,
      icon: iconUrl,
      stream: url,
      category,
      submittedBy: user.uid,
      submittedByName: user.displayName || user.email,
      status: 'pending',
      timestamp: Date.now()
    });

    showToast('Channel request submitted', 'success');
    document.getElementById('channel-name').value = '';
    document.getElementById('channel-url').value = '';
    statusText.textContent = '';
  } catch (err) {
    console.error(err);
    statusText.textContent = "Upload failed";
  }
};

// Approve request
async function approveRequest(id, channelData) {
  try {
    const editedName = document.getElementById(`name-${id}`).value.trim() || channelData.name;
    const editedUrl = document.getElementById(`url-${id}`).value.trim() || channelData.url;
    const editedCategory = document.getElementById(`category-${id}`).value || channelData.category;
    const iconFileInput = document.getElementById(`icon-file-${id}`);

    let iconUrl = channelData.icon;
    if (iconFileInput.files.length > 0) {
      iconUrl = await uploadToImgBB(iconFileInput.files[0], iconFileInput);
      document.getElementById(`icon-preview-${id}`).src = iconUrl;
    }

    const newChannelRef = db.ref('channels').push();
    await newChannelRef.set({
      name: editedName,
      icon: iconUrl,
      url: editedUrl,
      category: editedCategory,
      createdBy: channelData.submittedBy,
      createdAt: Date.now()
    });

    await db.ref(`channelRequests/${id}`).remove();
    showToast(`${editedName} approved!`, 'success');
  } catch (err) {
    console.error(err);
    showToast("Error approving request", 'error');
  }
}

document.getElementById('logout-btn').addEventListener('click', async () => {
  await auth.signOut();
  showToast('Logged out', 'info');
  setTimeout(() => window.location.href = 'signin', 1000);
});
});
</script>
</body>
</html>