<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Live TV</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet"/>
<style>
  body { font-family: 'Baloo 2', cursive; background: #fafafa; }
  .scrollbar-hide::-webkit-scrollbar { display: none; }
  .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
</style>
</head>
<body class="w-screen h-screen flex flex-col overflow-hidden scroll-smooth">

  <!-- Header -->
  <div class="flex items-center justify-between px-5 py-5 bg-[#d92a1a] shadow-lg sticky top-0 z-50 animate-slideDown">
    <button aria-label="Menu" class="text-white text-3xl">
      <i class="fas fa-bars"></i>
    </button>
    <h1 class="text-white text-2xl sm:text-3xl font-extrabold tracking-wider select-none">
      Live TV
    </h1>
    <button aria-label="Notifications" class="text-white text-3xl">
      <i class="fas fa-bell"></i>
    </button>
  </div>

  <!-- Categories Row -->
  <nav id="categoriesRow"
    class="bg-white shadow-md flex space-x-3 overflow-x-auto text-gray-900 text-sm font-semibold tracking-wide py-3 px-3 select-none scrollbar-hide sticky top-[64px] z-40">
    <!-- Categories dynamically injected -->
  </nav>

  <!-- Channels Grid -->
  <div id="channelsGrid" class="flex-1 overflow-y-auto overscroll-contain bg-gray-50 p-3 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
    <!-- Channels dynamically injected -->
  </div>

<!-- âœ… Animations CSS -->
<script>
const style = document.createElement('style');
style.innerHTML = `
@keyframes ripple { to { transform: scale(4); opacity: 0; } }
.animate-ripple { position: relative; overflow: hidden; }
.animate-ripple::after {
  content: '';
  position: absolute;
  border-radius: 50%;
  background: rgba(255,255,255,0.6);
  width: 100px; height: 100px;
  transform: scale(0);
  opacity: 0.75;
  pointer-events: none;
  animation: ripple 0.5s linear;
}

@keyframes pop { 0% { transform: scale(0.9); opacity: 0; } 50% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); } }
.animate-pop { animation: pop 0.35s ease-out forwards; }

@keyframes slideDown { 0% { transform: translateY(-20px); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }
.animate-slideDown { animation: slideDown 0.5s ease-out forwards; }

@keyframes fadeUp { 0% { transform: translateY(20px) scale(0.95); opacity: 0; } 100% { transform: translateY(0) scale(1); opacity: 1; } }
.animate-fadeUp { animation: fadeUp 0.4s ease-out forwards; }
`;
document.head.appendChild(style);
</script>

<!-- Firebase & App Script -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
    authDomain: "tnm3ulive.firebaseapp.com",
    databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "tnm3ulive",
    storageBucket: "tnm3ulive.firebasestorage.app",
    messagingSenderId: "80664356882",
    appId: "1:80664356882:web:c8464819b0515ec9b210cb",
    measurementId: "G-FNS9JWZ9LS"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const categoriesRow = document.getElementById('categoriesRow');
  const channelsGrid = document.getElementById('channelsGrid');

  let allChannels = [];
  let currentCategory = 'All';

  const channelsRef = ref(db, 'channels');
  onValue(channelsRef, (snapshot) => {
    channelsGrid.innerHTML = '';
    categoriesRow.innerHTML = '';

    const data = snapshot.val();
    if (!data) return;

    allChannels = Object.values(data);

    const categories = ['All', ...new Set(allChannels.map(c => c.category))];

    categories.forEach(cat => {
      const btn = document.createElement('button');
      btn.className = `
        px-4 py-2 rounded-full transition-all duration-300
        ${cat === currentCategory ? 'bg-[#d92a1a] text-white scale-105 shadow-lg' : 'bg-gray-100 text-gray-800 hover:bg-gray-200'}
      `;
      btn.textContent = cat;
      btn.onclick = () => {
        currentCategory = cat;
        animateCategoryChange();
        renderChannels();
        updateCategoryButtons(categories);
      };
      categoriesRow.appendChild(btn);
    });

    renderChannels();
  });

  function renderChannels() {
    channelsGrid.innerHTML = '';
    const filtered = currentCategory === 'All'
      ? allChannels
      : allChannels.filter(c => c.category === currentCategory);

    filtered.forEach((ch, index) => {
      const card = document.createElement('div');
      card.className = `
        bg-white rounded-2xl shadow-md hover:shadow-xl overflow-hidden cursor-pointer
        transform transition hover:scale-105 flex flex-col items-center justify-between
        p-3 h-44 relative animate-fadeUp
      `;
      card.style.animationDelay = `${index * 0.05}s`; // Staggered animation for premium feel
      card.innerHTML = `
        <div class="w-full h-28 bg-gray-100 flex items-center justify-center rounded-xl">
          <img src="${ch.icon}" alt="${ch.name}" class="h-20 w-auto max-w-[80%] object-contain">
        </div>
        <div class="mt-2 text-center text-gray-800 font-semibold text-base truncate w-full">
          ${ch.name}
        </div>
      `;
      card.onclick = (e) => {
        rippleEffect(e, card);
        setTimeout(() => {
          window.open(ch.stream, '_blank');
        }, 200);
      };
      channelsGrid.appendChild(card);
    });

    // Fill empty grid cells for balance if needed
    const totalCards = filtered.length;
    const cols = window.innerWidth >= 768 ? 4 : (window.innerWidth >= 640 ? 3 : 2);
    const remainder = totalCards % cols;
    if (remainder > 0) {
      const fillers = cols - remainder;
      for (let i = 0; i < fillers; i++) {
        const emptyCard = document.createElement('div');
        emptyCard.className = 'invisible';
        channelsGrid.appendChild(emptyCard);
      }
    }
  }

  function updateCategoryButtons(categories) {
    categoriesRow.querySelectorAll('button').forEach(btn => {
      if (btn.textContent === currentCategory) {
        btn.className = `
          px-4 py-2 rounded-full bg-[#d92a1a] text-white scale-105 shadow-lg transition-all duration-300
        `;
      } else {
        btn.className = `
          px-4 py-2 rounded-full bg-gray-100 text-gray-800 hover:bg-gray-200 transition-all duration-300
        `;
      }
    });
  }

  function rippleEffect(event, element) {
    const ripple = document.createElement('span');
    ripple.className = 'absolute bg-white rounded-full opacity-75 animate-ripple';
    const rect = element.getBoundingClientRect();
    ripple.style.width = ripple.style.height = `${Math.max(rect.width, rect.height)}px`;
    ripple.style.left = `${event.clientX - rect.left - (rect.width / 2)}px`;
    ripple.style.top = `${event.clientY - rect.top - (rect.height / 2)}px`;
    element.appendChild(ripple);
    setTimeout(() => ripple.remove(), 500);
  }

  function animateCategoryChange() {
    channelsGrid.style.opacity = '0';
    setTimeout(() => {
      channelsGrid.style.opacity = '1';
    }, 150);
  }
</script>
</body>
</html>
