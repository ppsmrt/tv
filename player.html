<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Live Player</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<style>
  body { margin:0; background:#111; font-family:sans-serif; display:flex; justify-content:center; align-items:center; min-height:100vh; }
  .player-card { position:relative; max-width:900px; width:100%; border-radius:16px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,0.7); }
  video { width:100%; display:block; object-fit:cover; border-radius:16px 16px 0 0; z-index:0; }
  video::-webkit-media-controls { display:none !important; }
  video::-moz-media-controls { display:none !important; }
  #header { position:fixed; top:0; left:0; width:100%; display:flex; justify-content:space-between; align-items:center; padding:12px 20px; background:#7b5cf7; color:white; font-size:1.4rem; font-weight:bold; z-index:60; border-bottom-left-radius:12px; border-bottom-right-radius:12px; }
  #header button { background:rgba(255,255,255,0.2); padding:6px 10px; border-radius:6px; transition:all 0.3s; }
  #header button:hover { background:rgba(255,255,255,0.4); transform:scale(1.1); }
  #overlayInfo { position:absolute; top:20px; left:20px; background:rgba(0,0,0,0.5); color:white; padding:6px 10px; border-radius:6px; font-size:14px; z-index:30; }
  #btnPlayPause { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:3rem; color:white; cursor:pointer; z-index:50; transition:transform 0.3s; }
  #btnPlayPause:hover { transform:translate(-50%,-50%) scale(1.2); }
  #controlsContainer { position:relative; display:flex; justify-content:space-around; align-items:center; padding:10px 20px; border-radius:0 0 16px 16px; background:rgba(255,255,255,0.05); backdrop-filter:blur(10px); margin-top:-8px; opacity:0; transition:opacity 0.3s; z-index:45; }
  .control-btn { color:white; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.3s; }
  .control-btn:hover { transform:scale(1.2); }
  #volumeSlider, #speedSelect { background:rgba(255,255,255,0.1); color:white; border:none; padding:4px 8px; border-radius:6px; cursor:pointer; }
  #qualityContainer { display:flex; align-items:center; color:white; }
  #qualityIndicator { margin-left:6px; font-weight:bold; }
  /* Ads section */
  #adsSection { width:100%; background:rgba(255,255,255,0.05); backdrop-filter:blur(10px); padding:8px 0; overflow:hidden; border-radius:0 0 16px 16px; margin-top:10px; }
  #adsText { display:inline-block; white-space:nowrap; color:white; font-weight:bold; animation:scrollAds 10s linear infinite; }
  @keyframes scrollAds { 0% { transform:translateX(100%);} 100% { transform:translateX(-100%);} }
</style>
</head>
<body>

<div class="player-card">
  <!-- Video -->
  <video id="videoPlayer" autoplay muted playsinline controlslist="nodownload nofullscreen noremoteplayback"></video>

  <!-- Play/Pause Overlay -->
  <div id="btnPlayPause"><i class="fa fa-play"></i></div>

  <!-- Overlay Info -->
  <div id="overlayInfo">Live TV</div>

  <!-- Controls -->
  <div id="controlsContainer">
    <div class="control-btn" id="btnPlayPauseBottom"><i class="fa fa-play fa-lg"></i></div>
    <div class="control-btn" id="btnFullscreen"><i class="fa fa-expand fa-lg"></i></div>
    <div class="control-btn" id="btnPiP"><i class="fa fa-window-restore fa-lg"></i></div>
    <div class="control-btn">
      <i class="fa fa-volume-up fa-lg"></i>
      <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
    </div>
    <div class="control-btn">
      <i class="fa fa-tachometer-alt fa-lg"></i>
      <select id="speedSelect">
        <option value="1" selected>1x</option>
        <option value="2">2x</option>
        <option value="3">3x</option>
      </select>
    </div>
    <div class="control-btn" id="qualityContainer">
      <i class="fa fa-tv fa-lg"></i>
      <span id="qualityIndicator">HD</span>
    </div>
  </div>

  <!-- Ads Section -->
  <div id="adsSection">
    <div id="adsText">Ad: Thanks for watching the videos</div>
  </div>
</div>

<!-- Header -->
<div id="header">
  <span id="channelName">Channel</span>
  <button id="btnClose"><i class="fa fa-times"></i></button>
</div>

<script type="module">
const urlParams = new URLSearchParams(window.location.search);
const channelNameParam = urlParams.get('name') || "Unknown Channel";
const streamURL = decodeURIComponent(urlParams.get('stream') || "");

const video = document.getElementById('videoPlayer');
const btnPlayPause = document.getElementById('btnPlayPause');
const btnPlayPauseBottom = document.getElementById('btnPlayPauseBottom');
const btnClose = document.getElementById('btnClose');
const controlsContainer = document.getElementById('controlsContainer');
const channelNameEl = document.getElementById('channelName');
const qualityIndicator = document.getElementById('qualityIndicator');
const qualityContainer = document.getElementById('qualityContainer');

channelNameEl.textContent = channelNameParam;

// Close button
btnClose.onclick = () => window.location.href = '/tv/index.html';

// Show/Hide Controls with auto-hide
let hideControlsTimeout;
function showControls(){
  controlsContainer.style.opacity = 1;
  btnPlayPause.style.opacity = 1;
  clearTimeout(hideControlsTimeout);
  hideControlsTimeout = setTimeout(()=>{ controlsContainer.style.opacity = 0; btnPlayPause.style.opacity = 0; }, 3000);
}
video.addEventListener('click', showControls);

// Play/Pause
function togglePlay(){
  if(video.paused){ video.play(); btnPlayPause.innerHTML='<i class="fa fa-pause"></i>'; btnPlayPauseBottom.innerHTML='<i class="fa fa-pause fa-lg"></i>'; }
  else{ video.pause(); btnPlayPause.innerHTML='<i class="fa fa-play"></i>'; btnPlayPauseBottom.innerHTML='<i class="fa fa-play fa-lg"></i>'; }
}
btnPlayPause.onclick = togglePlay;
btnPlayPauseBottom.onclick = togglePlay;

// Fullscreen
document.getElementById('btnFullscreen').onclick = ()=>{ if(video.requestFullscreen) video.requestFullscreen(); };

// PiP
document.getElementById('btnPiP').onclick = async ()=>{
  try{ if(document.pictureInPictureElement) await document.exitPictureInPicture();
  else await video.requestPictureInPicture();
  }catch(e){console.log(e);}
};

// Volume
document.getElementById('volumeSlider').oninput = e=>video.volume=e.target.value;

// Speed
document.getElementById('speedSelect').onchange = e=>video.playbackRate=parseFloat(e.target.value);

// HLS with HD/SD indicator
function setupHLS(url){
  if(Hls.isSupported()){
    const hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED,()=>{
      video.play();
      video.controls=false;
      video.removeAttribute('controls');
      const levels = hls.levels;
      if(levels.length>1){
        hls.on(Hls.Events.LEVEL_SWITCHED,()=>{
          const height=hls.levels[hls.currentLevel].height;
          qualityIndicator.textContent = height>=720?'HD':'SD';
        });
        qualityIndicator.textContent = hls.levels[hls.currentLevel].height>=720?'HD':'SD';
      } else qualityContainer.style.display='none';
    });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')){
    video.src=url;
    video.addEventListener('loadedmetadata',()=>video.play());
    qualityContainer.style.display='none';
  }
}

video.controls=false;
video.removeAttribute('controls');
setupHLS(streamURL);
showControls();
</script>

</body>
</html>