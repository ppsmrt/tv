<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium Live Player</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="assets/css/style.css">
<style>
  body { background:#111; font-family:sans-serif; display:flex; justify-content:center; align-items:center; min-height:100vh; }
  .player-card { position:relative; max-width:900px; width:100%; background:#1c1c1c; border-radius:16px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,0.7); }
  video { width:100%; border-radius:16px; background:black; }
  #header { width:100%; display:flex; justify-content:space-between; align-items:center; padding:12px 20px; background:#7b5cf7; color:white; font-size:1.4rem; font-weight:bold; z-index:15; }
  #header button { background:rgba(255,255,255,0.2); padding:6px 10px; border-radius:6px; transition:all 0.3s; }
  #header button:hover { background:rgba(255,255,255,0.4); transform:scale(1.1); }
  .controls { position:absolute; bottom:15px; left:0; right:0; display:flex; justify-content:space-around; align-items:center; padding:0 20px; opacity:0.95; }
  .control-btn { color:white; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.3s; }
  .control-btn:hover { transform:scale(1.2); }
  #volumeSlider, #speedSelect, #qualitySelect { background:rgba(255,255,255,0.1); color:white; border:none; padding:4px 8px; border-radius:6px; cursor:pointer; }
  #overlayInfo { position:absolute; top:60px; left:20px; background:rgba(0,0,0,0.5); color:white; padding:6px 10px; border-radius:6px; font-size:14px; }
  .premium-watermark { position:absolute; top:10px; right:10px; color:white; font-weight:bold; background:rgba(0,0,0,0.4); padding:4px 8px; border-radius:6px; animation:pulse 2s infinite; }
  @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.6; } }
</style>
</head>
<body>

<div class="player-card">
  <!-- Header -->
  <div id="header">
    <span id="channelName">Channel</span>
    <button id="btnClose"><i class="fa fa-times"></i></button>
  </div>

  <!-- Video -->
  <video id="videoPlayer" autoplay muted></video>

  <!-- Premium watermark -->
  <div class="premium-watermark">Premium</div>

  <!-- Overlay Info -->
  <div id="overlayInfo">Live Now</div>

  <!-- Controls -->
  <div class="controls">
    <div class="control-btn" id="btnPlayPause"><i class="fa fa-play fa-lg"></i></div>
    <div class="control-btn" id="btnFullscreen"><i class="fa fa-expand fa-lg"></i></div>
    <div class="control-btn">
      <i class="fa fa-volume-up fa-lg"></i>
      <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="1">
    </div>
    <div class="control-btn">
      <i class="fa fa-tachometer-alt fa-lg"></i>
      <select id="speedSelect">
        <option value="1" selected>1x</option>
        <option value="2">2x</option>
        <option value="3">3x</option>
      </select>
    </div>
    <div class="control-btn" id="qualityContainer" style="display:none;">
      <i class="fa fa-tv fa-lg"></i>
      <select id="qualitySelect"></select>
      <span id="qualityIndicator" class="ml-2 text-sm"></span>
    </div>
  </div>
</div>

<script type="module">
const urlParams = new URLSearchParams(window.location.search);
const channelNameParam = urlParams.get('name') || "Unknown Channel";
const streamURL = decodeURIComponent(urlParams.get('stream') || "");

const video = document.getElementById('videoPlayer');
const channelNameEl = document.getElementById('channelName');
const overlayInfo = document.getElementById('overlayInfo');

channelNameEl.textContent = channelNameParam;
overlayInfo.textContent = "Live Now: " + channelNameParam;

const btnClose = document.getElementById('btnClose');
btnClose.onclick = () => window.location.href = '/tv/index.html';

// Play/Pause
const btnPlayPause = document.getElementById('btnPlayPause');
btnPlayPause.onclick = () => {
  if(video.paused) { video.play(); btnPlayPause.innerHTML = '<i class="fa fa-pause fa-lg"></i>'; }
  else { video.pause(); btnPlayPause.innerHTML = '<i class="fa fa-play fa-lg"></i>'; }
};

// Fullscreen
document.getElementById('btnFullscreen').onclick = () => { if(video.requestFullscreen) video.requestFullscreen(); };

// Volume
const volumeSlider = document.getElementById('volumeSlider');
volumeSlider.oninput = (e) => { video.volume = e.target.value; };

// Speed
const speedSelect = document.getElementById('speedSelect');
speedSelect.onchange = (e) => { video.playbackRate = parseFloat(e.target.value); };

// HLS with quality selection
const qualityContainer = document.getElementById('qualityContainer');
const qualitySelect = document.getElementById('qualitySelect');
const qualityIndicator = document.getElementById('qualityIndicator');

function setupHLS(url) {
  if(Hls.isSupported()) {
    const hls = new Hls({ capLevelToPlayerSize:true });
    hls.loadSource(url);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, () => {
      video.play();
      const levels = hls.levels;
      if(levels.length > 1) {
        qualityContainer.style.display = "flex";
        qualitySelect.innerHTML = '';
        levels.forEach((level,i)=>{
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = level.height + 'p';
          qualitySelect.appendChild(opt);
        });
        qualityIndicator.textContent = levels[hls.currentLevel]?.height + 'p';
        qualitySelect.onchange = (e) => { hls.currentLevel = parseInt(e.target.value); qualityIndicator.textContent = levels[hls.currentLevel]?.height + 'p'; };
      } else {
        qualityContainer.style.display = "none";
      }
    });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = url;
    video.addEventListener('loadedmetadata', () => video.play());
    qualityContainer.style.display = "none";
  }
}

setupHLS(streamURL);

</script>
</body>
</html>