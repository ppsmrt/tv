<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Notifications - Live TV</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>

<!-- Baloo 2 Font -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2&display=swap" rel="stylesheet"/>

<style>
  html, body {
    font-family: 'Baloo 2', cursive;
    background-color: #111827;
    color: #fff;
    margin: 0;
    min-height: 100vh;
  }

  header {
    height: 64px;
    display: flex;
    align-items: center;
    padding: 0 1.5rem;
    background: rgba(31,41,55,0.9);
    box-shadow: 0 2px 8px rgba(0,0,0,0.5);
    z-index: 20;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  #footer {
    height: 64px;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(31,41,55,0.9);
    box-shadow: 0 -2px 8px rgba(0,0,0,0.5);
    z-index: 20;
    user-select: text;      
    -webkit-user-select: text;
    pointer-events: auto;
  }

  main {
    padding: 84px 1rem 84px;
    max-width: 800px;
    margin: 0 auto;
  }

  .notification-card {
    display: flex;
    align-items: center;
    background: #1f2937;
    border-radius: 12px;
    padding: 12px 16px;
    margin-bottom: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
    cursor: pointer;
  }
  .notification-card:hover {
    background: #374151;
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(248,113,113,0.4);
  }

  .notification-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    object-fit: cover;
    margin-right: 16px;
    flex-shrink: 0;
    background: #111;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
  }

  .notification-content {
    flex: 1;
  }
  .notification-title {
    font-weight: 700;
    font-size: 1rem;
    color: #f9fafb;
  }
  .notification-category {
    font-size: 0.875rem;
    color: #9ca3af;
  }

  .empty-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-top: 3rem;
    text-align: center;
    animation: fadeIn 0.5s ease-in-out;
  }
  .empty-state .title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #f87171;
    margin-bottom: 1rem;
  }
  .empty-state img {
    max-width: 240px;
    border-radius: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.6);
  }

  .skeleton {
    background: #1f2937;
    border-radius: 12px;
    height: 70px;
    margin-bottom: 12px;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* NEW badge + glow for recently added notifications */
  .new-badge {
    display: inline-block;
    background: #f87171;
    color: #fff;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 8px;
    margin-left: 8px;
  }

  .notification-card.new {
    animation: glow 1.5s ease-in-out 2;
    border: 1px solid #f87171;
  }

  @keyframes glow {
    0%, 100% { box-shadow: 0 0 10px #f87171; }
    50% { box-shadow: 0 0 20px #f87171; }
  }
</style>
</head>
<body>

<!-- Header -->
<div id="header"></div>

<main id="notificationsContainer">
  <div class="skeleton"></div>
  <div class="skeleton"></div>
  <div class="skeleton"></div>
</main>
  
<!-- Footer -->
<div id="footer"></div>

<!-- JS Files -->
<script type="module" src="assets/js/header.js"></script>
<script type="module" src="assets/js/footer.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
  authDomain: "tnm3ulive.firebaseapp.com",
  databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tnm3ulive",
  storageBucket: "tnm3ulive.firebasestorage.app",
  messagingSenderId: "80664356882",
  appId: "1:80664356882:web:c8464819b0515ec9b210cb",
  measurementId: "G-FNS9JWZ9LS"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const container = document.getElementById('notificationsContainer');

function timeAgo(timestamp) {
  if (!timestamp) return "";
  const diff = Math.floor((Date.now() - timestamp) / 1000);
  if (diff < 60) return `${diff}s ago`;
  if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
  if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
  return `${Math.floor(diff / 86400)}d ago`;
}

// Create Notification Card
function createNotificationCard(notification) {
  const card = document.createElement('div');
  card.className = 'notification-card';
  if (notification.url) card.onclick = () => window.open(notification.url, "_blank");

  // Highlight new notifications added in last 24 hours
  const ONE_DAY = 24 * 60 * 60 * 1000;
  const isNew = Date.now() - (notification.timestamp || 0) < ONE_DAY;
  if (isNew) card.classList.add('new');

  const img = document.createElement('img');
  img.className = 'notification-icon';
  img.src = notification.logo && notification.logo.trim() !== '' ? notification.logo : '';
  img.alt = (notification.name || "Notification") + ' logo';
  img.onerror = () => {
    const icon = document.createElement('span');
    icon.className = 'material-icons notification-icon';
    icon.textContent = 'notifications';
    img.replaceWith(icon);
  };

  const content = document.createElement('div');
  content.className = 'notification-content';

  const title = document.createElement('div');
  title.className = 'notification-title';
  title.textContent = notification.message || "New Update";

  if (isNew) {
    const badge = document.createElement('span');
    badge.className = 'new-badge';
    badge.textContent = 'NEW';
    title.appendChild(badge);
  }

  const meta = document.createElement('div');
  meta.className = 'notification-category';
  meta.textContent = `${notification.category || 'Update'} • ${timeAgo(notification.timestamp)}`;

  content.appendChild(title);
  content.appendChild(meta);
  card.appendChild(img);
  card.appendChild(content);

  return card;
}

function renderEmptyState() {
  container.innerHTML = `
    <div class="empty-state">
      <div class="title">ஒன்னும் இல்லை!</div>
      <img src="https://tvicn.wordpress.com/wp-content/uploads/2025/09/20250903_0032382345023889667523819.jpg" alt="Empty State"/>
    </div>
  `;
}

function renderNotifications(list) {
  container.innerHTML = '';
  if (list.length === 0) {
    renderEmptyState();
    return;
  }
  list.forEach(n => container.appendChild(createNotificationCard(n)));
}

let channelsCache = [];
let notificationsCache = [];

onValue(ref(db, 'channels'), (snapshot) => {
  const data = snapshot.val() || {};
  channelsCache = Object.entries(data).map(([id, c]) => ({
    message: `New channel added: ${c.name || 'Unknown'}`,
    logo: c.logo || '',
    url: c.url || '',
    timestamp: c.timestamp || 0,
    category: 'Channel'
  }));
  updateUI();
});

onValue(ref(db, 'notifications'), (snapshot) => {
  const data = snapshot.val() || {};
  notificationsCache = Object.entries(data).map(([id, n]) => ({
    message: n.message,
    logo: n.logo || '',
    url: n.url || '',
    timestamp: n.timestamp || 0,
    category: n.type || 'Notification'
  }));
  updateUI();
});

// Merge and Render (Newest First)
function updateUI() {
  const merged = [...channelsCache, ...notificationsCache].sort((a, b) => b.timestamp - a.timestamp);
  renderNotifications(merged);
}
</script>

</body>
</html>