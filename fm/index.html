<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FM Radio</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Baloo 2', cursive; }
    .scrollbar-hide::-webkit-scrollbar { display: none; }
    .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

    @keyframes pulse {0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
    @keyframes bounce {0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
    @keyframes spin-slow {0% { transform: rotate(0deg);}100% { transform: rotate(360deg);} }
    .animate-spin-slow { animation: spin-slow 6s linear infinite; }
    @keyframes wave {0%,100% { height: 20%; }50% { height: 80%; } }
    .animate-wave { animation: wave 1s ease-in-out infinite; }
    .delay-200 { animation-delay: 0.2s; }
    .delay-400 { animation-delay: 0.4s; }
    .delay-600 { animation-delay: 0.6s; }
    .delay-800 { animation-delay: 0.8s; }
  </style>
</head>

<body class="bg-gray-100 overflow-x-hidden">

  <!-- Header -->
  <header class="bg-gradient-to-r from-indigo-600 to-sky-500 text-white rounded-b-2xl shadow-lg p-4 text-center">
    <div class="flex justify-between items-center text-sm font-semibold opacity-90 mb-2">
      <span id="current-time">--:--</span>
      <span id="battery-status">ðŸ”‹ --%</span>
    </div>
    <div class="w-24 h-24 bg-white/20 backdrop-blur-md rounded-full mx-auto flex items-center justify-center animate-pulse">
      <i class="fa-solid fa-headphones text-3xl text-white"></i>
    </div>
    <div class="mt-2">
      <div id="headerStation" class="font-bold text-xl animate-pulse">--</div>
      <div id="headerLocation" class="text-sm opacity-80">--</div>
    </div>
  </header>

<!-- Notification -->
<div class="px-5 mt-3">
  <div id="notificationBanner" class="bg-indigo-50 border-l-4 border-indigo-600 text-indigo-800 p-3 rounded-2xl shadow-md text-center text-sm transition-opacity duration-500 opacity-100">
    ðŸ“¢ New stations live!
  </div>
</div>

<script>
  const messages = [
    "ðŸ“¢ New stations live!",
    "ðŸŽ¶ Trending now on FM Radio!",
    "â­ Save your favourite stations!",
    "ðŸ“¡ Listen to live Tamil FM!"
  ];

  let index = 0;
  const banner = document.getElementById("notificationBanner");

  setInterval(() => {
    // Fade out
    banner.classList.add("opacity-0");

    setTimeout(() => {
      // Change text and fade in
      index = (index + 1) % messages.length;
      banner.textContent = messages[index];
      banner.classList.remove("opacity-0");
    }, 500); // Match transition duration
  }, 5000); // Change every 5 seconds
</script>

  <!-- Search -->
  <div class="px-5 py-3">
    <input type="text" id="channelSearch" placeholder="Search Stations..." class="w-full px-4 py-2 rounded-full shadow-md border-none focus:ring-2 focus:ring-indigo-500 outline-none text-sm">
  </div>

  <!-- SPA Pages -->
  <section id="page-home" class="px-5 py-3 space-y-4 max-h-[60vh] overflow-y-auto scrollbar-hide">
    <div id="stationList" class="space-y-3"></div>
  </section>
  <section id="page-favourites" class="hidden px-5 py-3 text-center">
    <h2 class="text-lg font-bold mb-2">Favourites</h2>
    <div id="favList" class="space-y-3"></div>
  </section>
  <section id="page-trending" class="hidden px-5 py-3 text-center">
    <h2 class="text-lg font-bold mb-2">Trending</h2>
    <div id="trendingList" class="space-y-3"></div>
  </section>

  <section id="page-about" class="hidden px-5 py-6 text-left space-y-6 overflow-y-auto max-h-[70vh]">
  <!-- About -->
  <div class="bg-white/10 backdrop-blur-md rounded-2xl p-5 shadow">
    <h2 class="text-lg font-bold mb-2">ðŸ“» About This App</h2>
    <p class="text-sm text-gray-800 leading-relaxed">
      <span class="font-semibold">FM Radio Premium</span> is a modern streaming radio app 
      designed to deliver high-quality audio from Tamil, Telugu, Malayalam, Hindi, and international FM stations.  
      Enjoy music, talk shows, and news with a sleek interface, favourites, trending stations, 
      and a responsive mini-player that keeps your listening smooth and uninterrupted.
    </p>
  </div>

  <!-- Author -->
  <div class="bg-white/10 backdrop-blur-md rounded-2xl p-5 shadow">
    <h2 class="text-lg font-bold mb-2">ðŸ‘¤ Author & Developer</h2>
    <p class="text-sm text-gray-800 leading-relaxed">
      This app is developed by <span class="font-semibold">Palani</span>, 
      an independent developer passionate about building apps that combine 
      entertainment with simplicity.  
      Feedback and suggestions are always welcome to help improve your listening experience.
    </p>
  </div>

  <!-- Privacy -->
  <div class="bg-white/10 backdrop-blur-md rounded-2xl p-5 shadow">
    <h2 class="text-lg font-bold mb-2">ðŸ”’ Privacy & Data Policy</h2>
    <p class="text-sm text-gray-800 leading-relaxed">
      We respect your privacy.  
      <br><br>
      â€¢ No personal data is collected, stored, or sold. <br>
      â€¢ Your favourites and preferences remain only on your device. <br>
      â€¢ Streaming content is provided by third-party radio stations; their servers 
        may process technical data (like IP address) required to deliver streams. <br>
      â€¢ Server uses for analytics, stability, and notifications, but 
        without collecting sensitive personal information.  
      <br><br>
      Our goal is to keep your experience safe, transparent, and enjoyable.
    </p>
  </div>
</section>

  <!-- Mini Player -->
  <div id="miniPlayer" class="fixed bottom-20 left-3 right-3 bg-indigo-600 text-white rounded-2xl p-3 flex flex-col md:flex-row justify-between items-center shadow-lg backdrop-blur-md hidden cursor-pointer transition-all">
    <div class="flex justify-between items-center w-full md:w-auto gap-2">
      <span id="miniStation" class="text-sm md:text-base font-semibold">Playing: --</span>
      <div class="flex gap-2 ml-2 md:ml-4">
        <button id="playPauseBtn" class="w-9 h-9 bg-white/20 rounded-xl flex justify-center items-center hover:bg-white/40 transition"><i class="fa-solid fa-play"></i></button>
        <button id="muteBtn" class="w-9 h-9 bg-white/20 rounded-xl flex justify-center items-center hover:bg-white/40 transition"><i class="fa-solid fa-volume-high"></i></button>
        <button id="stopBtn" class="w-9 h-9 bg-white/20 rounded-xl flex justify-center items-center hover:bg-white/40 transition"><i class="fa-solid fa-stop"></i></button>
      </div>
    </div>
  </div>

  <!-- Footer SPA Navigation -->
  <footer class="fixed bottom-0 left-0 right-0 bg-white/10 backdrop-blur-md flex justify-around p-2 text-xs font-semibold rounded-t-2xl shadow-inner">
    <div id="nav-home" class="flex flex-col items-center cursor-pointer hover:translate-y-1 transition">
      <i class="fa-solid fa-house"></i>Home
    </div>
    <div id="nav-favourites" class="flex flex-col items-center cursor-pointer hover:translate-y-1 transition">
      <i class="fa-solid fa-star"></i>Favourites
    </div>
    <div id="nav-trending" class="flex flex-col items-center cursor-pointer hover:translate-y-1 transition">
      <i class="fa-solid fa-fire"></i>Trending
    </div>
    <div id="nav-about" class="flex flex-col items-center cursor-pointer hover:translate-y-1 transition">
      <i class="fa-solid fa-circle-info"></i>About
    </div>
  </footer>

  <!-- Screensaver -->
  <div id="screensaver" class="fixed inset-0 bg-black/90 z-50 flex flex-col justify-center items-center hidden">
    <div class="w-40 h-40 rounded-full overflow-hidden border-8 border-white mb-6 animate-spin-slow flex justify-center items-center">
      <i class="fa-solid fa-compact-disc text-6xl text-white"></i>
    </div>
    <div class="w-48 h-6 flex justify-around items-end mb-4">
      <div class="w-2 bg-indigo-500 animate-wave"></div>
      <div class="w-2 bg-indigo-500 animate-wave delay-200"></div>
      <div class="w-2 bg-indigo-500 animate-wave delay-400"></div>
      <div class="w-2 bg-indigo-500 animate-wave delay-600"></div>
      <div class="w-2 bg-indigo-500 animate-wave delay-800"></div>
    </div>
    <div class="text-center text-white">
      <div id="screensaverStation" class="text-xl font-bold mb-1">--</div>
      <div id="screensaverLanguage" class="text-sm opacity-80 mb-2">--</div>
      <div id="screensaverTime" class="text-sm opacity-80">--:--</div>
    </div>
  </div>

  <!-- Radio Info Modal -->
  <div id="radioInfoModal" class="fixed inset-0 bg-black/70 z-60 flex justify-center items-center hidden">
    <div class="bg-white rounded-2xl p-6 w-80 text-center">
      <h2 class="text-lg font-bold mb-2" id="infoName">Radio Name</h2>
      <p id="infoLanguage" class="mb-1">Language: --</p>
      <p id="infoLocation" class="mb-1">Location: --</p>
      <p id="infoType" class="mb-1">Type: --</p>
      <p id="infoGenre" class="mb-2">Genre: --</p>
      <button id="closeModal" class="bg-indigo-600 text-white px-4 py-2 rounded-full mt-2">Close</button>
    </div>
  </div>

  <!-- JS -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
      authDomain: "tnm3ulive.firebaseapp.com",
      databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "tnm3ulive",
      storageBucket: "tnm3ulive.firebasestorage.app",
      messagingSenderId: "80664356882",
      appId: "1:80664356882:web:c8464819b0515ec9b210cb",
      measurementId: "G-FNS9JWZ9LS"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const audio = new Audio();
    audio.volume = 0.5;

    const stationList = document.getElementById("stationList");
    const miniPlayer = document.getElementById("miniPlayer");
    const miniStation = document.getElementById("miniStation");
    const playPauseBtn = document.getElementById("playPauseBtn");
    const stopBtn = document.getElementById("stopBtn");
    const muteBtn = document.getElementById("muteBtn");
    const headerStation = document.getElementById("headerStation");
    const headerLocation = document.getElementById("headerLocation");

    const screensaver = document.getElementById("screensaver");
    const screensaverStation = document.getElementById("screensaverStation");
    const screensaverLanguage = document.getElementById("screensaverLanguage");
    const screensaverTime = document.getElementById("screensaverTime");

    const radioInfoModal = document.getElementById("radioInfoModal");
    const closeModal = document.getElementById("closeModal");
    const infoName = document.getElementById("infoName");
    const infoLanguage = document.getElementById("infoLanguage");
    const infoLocation = document.getElementById("infoLocation");
    const infoType = document.getElementById("infoType");
    const infoGenre = document.getElementById("infoGenre");

    const favList = document.getElementById("favList");
    const trendingList = document.getElementById("trendingList");

    let radios = [];
    let currentIndex = null;
    let screensaverTimer;
    let favourites = [];

    function resetScreensaverTimer() {
      clearTimeout(screensaverTimer);
      screensaver.classList.add("hidden");
      if (!audio.src || audio.paused) return;
      screensaverTimer = setTimeout(() => {
        if (audio.src && !audio.paused) {
          screensaver.classList.remove("hidden");
          if (currentIndex !== null) {
            const radio = radios[currentIndex];
            screensaverStation.textContent = radio.name;
            screensaverLanguage.textContent = radio.language || radio.location || "";
            const now = new Date();
            screensaverTime.textContent = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
          }
        }
      }, 10000);
    }
    ['mousemove','keydown','touchstart','click'].forEach(evt => document.addEventListener(evt, resetScreensaverTimer));
    resetScreensaverTimer();

    function playRadio(index) {
      const radio = radios[index];
      if (!radio) return;

      if (currentIndex === index) {
        if (audio.paused) audio.play(); else audio.pause();
        playPauseBtn.innerHTML = audio.paused ? '<i class="fa-solid fa-play"></i>' : '<i class="fa-solid fa-pause"></i>';
        resetScreensaverTimer();
        return;
      }

      if (currentIndex !== null && currentIndex !== index) {
        audio.pause();
        audio.currentTime = 0;
      }

      audio.src = radio.stream;
      audio.play().catch(()=>console.log("Tap play to start audio"));
      currentIndex = index;

      miniStation.textContent = `Playing: ${radio.name}`;
      miniPlayer.classList.remove("hidden");
      playPauseBtn.innerHTML = '<i class="fa-solid fa-pause"></i>';
      headerStation.textContent = radio.name;
      headerLocation.textContent = radio.location || "";

      renderStationList();

      const radioRef = ref(db, `radios/${radio.id}/playCount`);
      runTransaction(radioRef, current => (current || 0) + 1);

      resetScreensaverTimer();
    }

    playPauseBtn.addEventListener("click", ()=>{
      if (!audio.src) return;
      if (audio.paused) audio.play(); else audio.pause();
      playPauseBtn.innerHTML = audio.paused ? '<i class="fa-solid fa-play"></i>' : '<i class="fa-solid fa-pause"></i>';
      resetScreensaverTimer();
    });

    muteBtn.addEventListener("click", ()=>{
      audio.muted = !audio.muted;
      muteBtn.innerHTML = audio.muted ? '<i class="fa-solid fa-volume-xmark"></i>' : '<i class="fa-solid fa-volume-high"></i>';
    });

    stopBtn.addEventListener("click", ()=>{
      audio.pause();
      audio.currentTime = 0;
      miniPlayer.classList.add("hidden");
      currentIndex = null;
      headerStation.textContent="--";
      headerLocation.textContent="--";
      resetScreensaverTimer();
    });

    function renderStationList() {
      const searchTerm = document.getElementById("channelSearch").value.toLowerCase();
      stationList.innerHTML = "";
      radios.forEach((radio,i)=>{
        if(!radio.name.toLowerCase().includes(searchTerm)) return;
        const isPlaying = currentIndex===i;
        const item = document.createElement("div");
        item.className = `station-item flex items-center gap-4 bg-white rounded-2xl p-3 shadow hover:-translate-y-1 hover:shadow-lg transition cursor-pointer ${isPlaying?'scale-[1.02] bg-blue-50':''}`;
        item.innerHTML=`
          <div class="w-12 h-12 flex justify-center items-center text-white text-lg rounded-xl bg-gradient-to-tr from-indigo-600 to-sky-500">
            <i class="fa-solid fa-radio"></i>
          </div>
          <div class="flex-1">
            <h2 class="text-sm font-semibold">${radio.name}</h2>
            <p class="text-xs text-gray-500">${radio.location||""}</p>
          </div>
          <span class="text-xs text-gray-600 play-count">${radio.playCount||0} plays</span>
          <i class="fa-regular fa-star text-indigo-600 ml-2 cursor-pointer"></i>
          <i class="fa-solid fa-ellipsis-vertical text-indigo-600 ml-2 cursor-pointer info-btn"></i>
        `;
        item.addEventListener("click",()=>playRadio(i));
        const favStar=item.querySelector(".fa-regular.fa-star");
        favStar.addEventListener("click", e=>{
          e.stopPropagation();
          favStar.classList.toggle("fa-solid");
          favStar.classList.toggle("animate-bounce");
          if(favourites.some(f=>f.id===radio.id)) favourites=favourites.filter(f=>f.id!==radio.id);
          else favourites.push(radio);
          renderFavourites();
          setTimeout(()=>favStar.classList.remove("animate-bounce"),500);
        });
        const infoBtn=item.querySelector(".info-btn");
        infoBtn.addEventListener("click", e=>{
          e.stopPropagation();
          infoName.textContent=radio.name;
          infoLanguage.textContent=`Language: ${radio.language||"--"}`;
          infoLocation.textContent=`Location: ${radio.location||"--"}`;
          infoType.textContent=`Type: ${radio.type||"FM/Live"}`;
          infoGenre.textContent=`Genre: ${radio.genre||"--"}`;
          radioInfoModal.classList.remove("hidden");
        });
        stationList.appendChild(item);
      });
    }

    function renderFavourites(){
      favList.innerHTML = "";
      if(favourites.length===0){
        favList.innerHTML="<p class='text-gray-500'>No favourites yet</p>";
        return;
      }
      favourites.forEach(radio=>{
        const div = document.createElement("div");
        div.className = "p-3 bg-white rounded-xl shadow cursor-pointer";
        div.innerHTML = `${radio.name} <span class="text-xs text-gray-500">(${radio.playCount||0} plays)</span>`;
        div.addEventListener("click",()=>{
          const index = radios.findIndex(r=>r.id===radio.id);
          playRadio(index);
          showPage('home');
        });
        favList.appendChild(div);
      });
    }

    function renderTrending(){
      trendingList.innerHTML = "";
      const sorted = [...radios].sort((a,b)=> (b.playCount||0)-(a.playCount||0)).slice(0,10);
      if(sorted.length===0){
        trendingList.innerHTML="<p class='text-gray-500'>No trending data</p>";
        return;
      }
      // finish renderTrending
      sorted.forEach(radio=>{
        const div = document.createElement("div");
        div.className = "p-3 bg-white rounded-xl shadow cursor-pointer";
        div.innerHTML = `${radio.name} <span class="text-xs text-gray-500">(${radio.playCount||0} plays)</span>`;
        div.addEventListener("click", ()=>{
          const index = radios.findIndex(item => item.id === radio.id);
          if (index !== -1) playRadio(index);
          showPage('home');
        });
        trendingList.appendChild(div);
      });
    } // end renderTrending

    // SPA page switching
    function showPage(page){
      const pages = {
        home: document.getElementById('page-home'),
        favourites: document.getElementById('page-favourites'),
        trending: document.getElementById('page-trending'),
        about: document.getElementById('page-about')
      };
      Object.values(pages).forEach(p => p.classList.add('hidden'));
      if(pages[page]) pages[page].classList.remove('hidden');

      if(page === 'favourites') renderFavourites();
      if(page === 'trending') renderTrending();
    }

    // Footer nav listeners
    const navHome = document.getElementById("nav-home");
    const navFav  = document.getElementById("nav-favourites");
    const navTrend = document.getElementById("nav-trending");
    const navAbout = document.getElementById("nav-about");

    navHome?.addEventListener("click", ()=> showPage('home'));
    navFav?.addEventListener("click", ()=> showPage('favourites'));
    navTrend?.addEventListener("click", ()=> showPage('trending'));
    navAbout?.addEventListener("click", ()=> showPage('about'));

    // Close info modal
    closeModal.addEventListener("click", ()=> radioInfoModal.classList.add("hidden"));
    radioInfoModal.addEventListener("click", (e)=>{
      if(e.target === radioInfoModal) radioInfoModal.classList.add("hidden");
    });

    // Firebase: load radios list
    onValue(ref(db,"radios"), snapshot=>{
      radios = [];
      if(snapshot.exists()){
        snapshot.forEach(child=>{
          radios.push({ id: child.key, ...child.val() });
        });
      }
      // keep currentIndex valid if possible
      if(currentIndex !== null){
        const stillExists = radios[currentIndex] && radios[currentIndex].id;
        if(!stillExists) currentIndex = null;
      }
      renderStationList();
      renderTrending();
    });

    // Search input
    const searchInput = document.getElementById("channelSearch");
    searchInput.addEventListener("input", renderStationList);

    // Current time & battery display
    function updateTime(){
      const now = new Date();
      document.getElementById('current-time').innerText = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
    }
    setInterval(updateTime, 1000);
    updateTime();

    if(navigator.getBattery){
      navigator.getBattery().then(battery=>{
        function updateBattery(){
          const percent = Math.floor(battery.level * 100);
          document.getElementById('battery-status').innerText = `ðŸ”‹ ${percent}%`;
        }
        updateBattery();
        battery.addEventListener('levelchange', updateBattery);
      }).catch(()=> {
        document.getElementById('battery-status').innerText = 'ðŸ”‹ N/A';
      });
    } else {
      document.getElementById('battery-status').innerText = 'ðŸ”‹ N/A';
    }

    // Show default page
    showPage('home');

  </script>
<body>
</html>