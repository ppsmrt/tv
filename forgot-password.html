<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Password Reset</title>
<style>
  body { font-family: Arial; background:#f5f5f5; display:flex; justify-content:center; align-items:center; height:100vh; }
  .container { background:#fff; padding:30px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1); max-width:400px; width:100%; }
  input, button { width:100%; padding:12px; margin:10px 0; border-radius:6px; border:1px solid #ccc; font-size:16px; }
  button { background:#4A90E2; color:#fff; border:none; cursor:pointer; font-weight:bold; }
  button:hover { background:#357ABD; }
  #message { font-size:14px; margin-top:10px; }
</style>
</head>
<body>

<div class="container">
  <h2 style="text-align:center;">Reset Password</h2>

  <input type="email" id="email" placeholder="Enter your email" required />
  <button id="send-code">Send Reset Code</button>

  <div id="reset-section" style="display:none;">
    <input type="text" id="code" placeholder="Enter code" required />
    <input type="password" id="new-password" placeholder="Enter new password" required />
    <button id="reset-password">Reset Password</button>
  </div>

  <p id="message"></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFunctions, httpsCallable } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";

const firebaseConfig = {
  apiKey: "AIzaSyB9GaCbYFH22WbiLs1pc_UJTsM_0Tetj6E",
  authDomain: "tnm3ulive.firebaseapp.com",
  databaseURL: "https://tnm3ulive-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tnm3ulive",
  storageBucket: "tnm3ulive.firebasestorage.app",
  messagingSenderId: "80664356882",
  appId: "1:80664356882:web:c8464819b0515ec9b210cb"
};

const app = initializeApp(firebaseConfig);
const functions = getFunctions(app);

const emailInput = document.getElementById("email");
const codeInput = document.getElementById("code");
const newPasswordInput = document.getElementById("new-password");
const sendCodeBtn = document.getElementById("send-code");
const resetBtn = document.getElementById("reset-password");
const message = document.getElementById("message");
const resetSection = document.getElementById("reset-section");

// Send code
sendCodeBtn.addEventListener("click", async () => {
  const email = emailInput.value.trim();
  if (!email) return message.textContent = "Enter your email";

  const sendCode = httpsCallable(functions, 'sendResetCode');
  try {
    await sendCode({ email });
    message.style.color = "green";
    message.textContent = "Reset code sent to your email!";
    resetSection.style.display = "block";
    sendCodeBtn.disabled = true;
  } catch (e) {
    message.style.color = "red";
    message.textContent = e.message;
  }
});

// Verify code & reset password
resetBtn.addEventListener("click", async () => {
  const email = emailInput.value.trim();
  const code = codeInput.value.trim();
  const newPassword = newPasswordInput.value;

  if (!code || !newPassword) return message.textContent = "Enter code & new password";

  const verifyReset = httpsCallable(functions, 'verifyCodeAndReset');
  try {
    await verifyReset({ email, code, newPassword });
    message.style.color = "green";
    message.textContent = "Password successfully reset!";
    resetSection.style.display = "none";
  } catch (e) {
    message.style.color = "red";
    message.textContent = e.message;
  }
});
</script>

</body>
</html>
